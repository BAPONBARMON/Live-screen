<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>Live Browser Connect</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase CDN -->
<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js" type="module"></script>
<script src="https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js" type="module"></script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:#fff;
  padding:15px;
}
h2{margin-top:0}
.user{
  background:#1e293b;
  padding:10px;
  margin-bottom:8px;
  border-radius:6px;
}
button{
  margin-top:6px;
  padding:6px 12px;
  border:none;
  border-radius:5px;
  background:#22c55e;
  color:#000;
}
</style>
</head>

<body>

<h2>ðŸŸ¢ Online Users</h2>
<div id="me"></div>
<hr>
<div id="users">Loading...</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getDatabase, ref, set, onValue, onDisconnect, remove } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-database.js";

/* ðŸ”¥ YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCm4osVK6qMHItwvwcThrjJf3DRJFBDNN8",
  authDomain: "live-screen-share.firebaseapp.com",
  databaseURL: "https://live-screen-share-default-rtdb.firebaseio.com",
  projectId: "live-screen-share",
  storageBucket: "live-screen-share.firebasestorage.app",
  messagingSenderId: "249637860812",
  appId: "1:249637860812:web:f59fe87ee7417cddd8d969"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

/* ðŸ‘¤ simple user id */
const myId = "user_" + Math.floor(Math.random()*10000);
document.getElementById("me").innerText =
  "You are online as: " + myId;

/* ðŸŸ¢ mark online */
const myRef = ref(db, "users/" + myId);
set(myRef, true);
onDisconnect(myRef).remove();

/* ðŸ‘¥ show online users */
const usersDiv = document.getElementById("users");

onValue(ref(db, "users"), snap => {
  usersDiv.innerHTML = "";
  snap.forEach(child => {
    const uid = child.key;
    if(uid === myId) return;

    const div = document.createElement("div");
    div.className = "user";
    div.innerHTML = `
      ${uid}<br>
      <button onclick="sendRequest('${uid}')">Request</button>
    `;
    usersDiv.appendChild(div);
  });

  if(usersDiv.innerHTML === ""){
    usersDiv.innerHTML = "No other users online";
  }
});

/* ðŸ“© send request */
window.sendRequest = function(to){
  set(ref(db, "requests/" + to), {
    from: myId
  });
  alert("Request sent to " + to);
}

/* ðŸ“¥ receive request */
onValue(ref(db, "requests/" + myId), snap => {
  if(!snap.exists()) return;

  const from = snap.val().from;
  const ok = confirm(from + " wants to connect. Accept?");
  remove(ref(db, "requests/" + myId));

  if(ok){
    alert("Connection accepted âœ…\n(Screen share next step)");
  }
});
</script>

</body>
</html>
