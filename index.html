<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>ðŸŒ¸ Live Browser View (Android Safe)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#fff}
header{padding:12px;background:#020617;text-align:center}
button{padding:12px;margin:6px;border:none;border-radius:8px;font-size:16px}
.primary{background:#22c55e}
textarea{width:100%;height:90px;margin-top:6px}
video{width:100%;background:#000;margin-top:10px}
.status{text-align:center;color:#94a3b8;font-size:14px}
</style>
</head>

<body>

<header>
  <h3>ðŸŒ¸ Live Browser View</h3>
  <div class="status" id="status">Ready</div>
</header>

<div style="padding:10px">

<button class="primary" onclick="start()">Start Live View</button>
<textarea id="offer" placeholder="Offer code (send this)"></textarea>

<button onclick="connect()">Connect Viewer</button>
<textarea id="answer" placeholder="Answer code (send back)"></textarea>

<video id="video" autoplay playsinline></video>

</div>

<script>
const pc = new RTCPeerConnection();
const video = document.getElementById("video");
const status = document.getElementById("status");

pc.ontrack = e => {
  video.srcObject = e.streams[0];
  status.innerText = "âœ… Connected";
};

async function start(){
  status.innerText = "Preparing live viewâ€¦";

  let stream;

  if (/Android/i.test(navigator.userAgent)) {
    // âœ… ANDROID SAFE MODE (tab-only view)
    stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "environment" }, audio:false
    });
    status.innerText = "Android mode: Browser view sharing";
  } else {
    // âœ… PC FULL SCREEN
    stream = await navigator.mediaDevices.getDisplayMedia({
      video:true, audio:false
    });
    status.innerText = "PC mode: Full screen sharing";
  }

  stream.getTracks().forEach(t => pc.addTrack(t, stream));
  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  pc.onicegatheringstatechange = ()=>{
    if(pc.iceGatheringState==="complete"){
      offer.value = JSON.stringify(pc.localDescription);
      document.getElementById("offer").value =
        JSON.stringify(pc.localDescription);
      status.innerText = "Offer ready â€“ send it";
    }
  };
}

async function connect(){
  const offerText = document.getElementById("offer").value;
  if(!offerText){ alert("Paste offer first"); return; }

  await pc.setRemoteDescription(JSON.parse(offerText));
  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);

  pc.onicegatheringstatechange = ()=>{
    if(pc.iceGatheringState==="complete"){
      document.getElementById("answer").value =
        JSON.stringify(pc.localDescription);
      status.innerText = "Answer ready â€“ send back";
    }
  };
}

document.getElementById("answer").addEventListener("change", async ()=>{
  await pc.setRemoteDescription(
    JSON.parse(document.getElementById("answer").value)
  );
});
</script>

</body>
</html>
