<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8">
<title>ğŸŒ¸ Smart Live Browser Screen</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#fff}
header{padding:12px;background:#020617;text-align:center}
button{padding:12px;margin:6px;border:none;border-radius:8px;font-size:16px}
.primary{background:#22c55e}
.secondary{background:#334155;color:#fff}
textarea{width:100%;height:100px;margin-top:6px}
#screenBox{position:relative;margin-top:10px}
video{width:100%;background:#000}
canvas{position:absolute;top:0;left:0}
.status{text-align:center;font-size:14px;color:#94a3b8}
</style>
</head>

<body>

<header>
  <h3>ğŸŒ¸ Smart Live Browser Screen</h3>
  <div class="status" id="status">Step 1: Start Screen Share</div>
</header>

<div style="padding:10px">

<h4>ğŸ‘¨â€ğŸ« Teacher</h4>
<button class="primary" onclick="startShare()">ğŸ“¤ Start Screen Share</button>
<textarea id="offerBox" placeholder="ğŸ”‘ Offer code (auto-generate hoga, isko viewer ko bhejo)"></textarea>

<hr>

<h4>ğŸ‘€ Viewer</h4>
<button class="secondary" onclick="createAnswer()">ğŸ“¥ Connect Viewer</button>
<textarea id="answerBox" placeholder="ğŸ” Answer code (teacher ko bhejo)"></textarea>

</div>

<div id="screenBox">
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
</div>

<script>
/* ======================
   WEBRTC CORE
====================== */

let pc = new RTCPeerConnection();
let video = document.getElementById("video");
let status = document.getElementById("status");

/* à¤œà¤¬ remote stream à¤†à¤ */
pc.ontrack = e => {
  video.srcObject = e.streams[0];
  status.innerText = "âœ… Connected â€“ Live Screen";
};

/* ======================
   TEACHER: START SHARE
====================== */

async function startShare(){
  status.innerText = "Sharing screenâ€¦ Please allow permission";

  const stream = await navigator.mediaDevices.getDisplayMedia({
    video:true, audio:false
  });

  stream.getTracks().forEach(track => pc.addTrack(track, stream));

  const offer = await pc.createOffer();
  await pc.setLocalDescription(offer);

  // ğŸ”‘ ICE complete à¤¹à¥‹à¤¨à¥‡ à¤•à¤¾ wait
  pc.onicegatheringstatechange = () => {
    if (pc.iceGatheringState === "complete") {
      document.getElementById("offerBox").value =
        JSON.stringify(pc.localDescription);
      status.innerText = "âœ… Offer generated â€“ Send it to viewer";
    }
  };
}

/* ======================
   VIEWER: CREATE ANSWER
====================== */

async function createAnswer(){
  status.innerText = "Connecting to teacherâ€¦";

  const offerText = document.getElementById("offerBox").value;
  if(!offerText){
    alert("Offer code paste karo pehle");
    return;
  }

  const offer = JSON.parse(offerText);
  await pc.setRemoteDescription(offer);

  const answer = await pc.createAnswer();
  await pc.setLocalDescription(answer);

  pc.onicegatheringstatechange = () => {
    if (pc.iceGatheringState === "complete") {
      document.getElementById("answerBox").value =
        JSON.stringify(pc.localDescription);
      status.innerText = "âœ… Answer ready â€“ Send back to teacher";
    }
  };
}

/* ======================
   TEACHER: ACCEPT ANSWER
====================== */

document.getElementById("answerBox")
.addEventListener("change", async ()=>{
  const answerText = document.getElementById("answerBox").value;
  if(!answerText) return;

  const answer = JSON.parse(answerText);
  await pc.setRemoteDescription(answer);
  status.innerText = "â³ Finalizing connectionâ€¦";
});
</script>

</body>
</html>
